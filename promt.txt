# Career coach booking system

## 项目背景与业务逻辑

### 1.1 核心业务形态

我们正在开发 **"Career Coach"**系统，这是一个连接**求职者 (User)** 与 **职业导师 (Coach)** 的在线辅导平台。

- **服务模式**：用户付费购买 30 分钟的 1-on-1 视频辅导课程。
- **用户侧**：用户在预约时必须提供**姓名**和**邮箱**，以便接收会议邀请和复盘资料。
- **导师侧**：平台拥有多位入驻导师（Coach Pool）。每位导师在 Onboarding（入驻）时会绑定自己的**工作邮箱**并授权日历。导师有各自特定的工作时间段（例如 Coach A 周一上午有空，Coach B 周三下午有空）。

### 1.2 调度与支付逻辑

为了高效处理复杂的排期逻辑，我们集成 **Cal.com** 和 **Stripe**。

- **多导师调度 (Round Robin)**：用户在前端选择一个时间段时，系统会在后台检查**所有导师**的日历。只要**任意一位**导师在该时间段有空，用户即可完成预约。具体分配给哪位导师，由 Cal.com 算法决定，并通过 Webhook 告知我们的后端。
- **付费门槛**：**每次会议都必须先付费**。只有支付成功后，预约才会生效。

### 1.3 你的任务

你需要使用 **Spring Boot** 和 **MySQL** 开发后端核心服务，负责：

1. **接收结果**：通过 Webhook 监听 Cal.com 的通知（告知哪个用户预约了、分派给了哪个导师、支付是否成功）。
2. **数据落库**：保存用户和导师的详细信息（姓名、邮箱），维护预约状态。
3. **API 交付**：为前端提供: “去预约”，“我的预约”以及“去取消”的接口。

---

## 技术栈建议

- **语言**: Java (JDK 17+)
- **框架**: **Spring Boot 3.x** (Web, MyBatis)
- **数据库**: **MySQL 8.0**
- **工具**: Gradle, Git

---

## 详细需求说明

### 3.1 用户与导师

在我们业务系统里，用户有全局唯一的userId。导师不在我们业务系统里，在cal平台onboarding。

### 3.2 状态枚举定义

预约状态流转必须严格遵循以下定义 (1)：

- `PENDING`: 初始状态
- `BOOKING_CREATED`: **[关键]** 支付成功且预约确认 (Active)，等待开课
- `BOOKING_CANCELLED`: 预约已取消
- `MEETING_ENDED`: 课程正常结束
- `NO_SHOW`: 用户或导师未出席

### 3.3 核心功能开发

### 功能 A: "去预约" 列表 (Booking API)

获取cal平台的预约链接。

- **接口地址**: `POST /api/booking-url`
- **请求参数**: `userId` （为了简化, api不需要鉴权，所以userId通过参数传即可）
- **数据返回**: 真实可预约的url

### 功能 B: "我的预约" 列表 (My Bookings API)

用户查询自己的预约记录。

- **接口地址**: `GET /api/bookings`
- **请求参数**: `userId` （为了简化, api不需要鉴权，所以userId通过参数传即可）
- **数据返回**: 预约状态，coach名称，预约时间段

### 功能 C: "去取消预约" (Cancel API)

- **接口地址**: `POST /api/bookings/cancel`
- **数据返回**: 真实可取消预约的url

### 功能 D: 接收预约回调 (Webhook Integration)

当用户完成支付并确认预约后，Cal.com 会发送 `BOOKING_CREATED` 事件。请实现接口处理此逻辑。

- **接口地址**: `POST /api/webhook/cal`

---

## 交付标准

1. **完整源码**: 良好编码习惯（github地址）
2. **交付目标 （录屏）**: 提供一个可在本地运行的后端服务，API 调用无需鉴权，能够完整演示预约与取消流程（会议可模拟，无需真实支付，录屏幕即可）

## TIP

跑通这个业务只需要一个邮箱即可。

这个邮箱注册个人cal.com帐号（免费），阅读相关cal.com文档，并且在cal.com模拟coach帐号（该邮箱可以跟业务系统的个人邮箱相同）